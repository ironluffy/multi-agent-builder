---
id: WP02.5
task_id: T019
title: Define Workspace table with worktree_path, branch_name, isolation_status
phase: Phase 2 - Foundational
lane: done
status: pending
created_at: 2025-11-21
started_at: 2025-11-22T13:31:20Z
completed_at: 2025-11-22T13:40:49Z
estimated_time: 20min
actual_time: null
depends_on: [T015]
files_modified: []
---

# WP02.5: Define Workspace table schema

## Objective

Define the Workspace table schema for tracking Git worktree-based isolated workspaces, including paths, branches, and isolation status.

## File Paths

- `migrations/001_initial_schema.sql` (Workspace table section)

## Work Content

1. Define workspace_status enum type:
   - 'active', 'merged', 'abandoned', 'cleanup_pending'
2. Create Workspace table with columns:
   - id UUID PRIMARY KEY
   - agent_id UUID REFERENCES Agent(id) UNIQUE NOT NULL
   - worktree_path VARCHAR(512) NOT NULL UNIQUE
   - branch_name VARCHAR(255) NOT NULL
   - isolation_status workspace_status DEFAULT 'active'
   - created_at TIMESTAMP DEFAULT NOW()
   - merged_at TIMESTAMP
   - cleaned_up_at TIMESTAMP
   - metadata JSONB
3. Add index on agent_id
4. Add CHECK constraint: worktree_path starts with valid directory

## Acceptance Criteria

- [ ] workspace_status enum type created
- [ ] Workspace table includes worktree_path and branch_name
- [ ] agent_id foreign key with UNIQUE constraint (1:1 relationship)
- [ ] worktree_path has UNIQUE constraint
- [ ] isolation_status tracks workspace lifecycle
- [ ] Timestamps for merge and cleanup tracking
- [ ] Index on agent_id for fast lookups

## Dependencies

Depends on T015 (migration file) and T016 (Agent table exists for foreign key).

## Parallel Execution

Part of T015's migration file - sequential after T016.

## Unit Tests

Workspace isolation validated in integration tests (Phase 6, US4).

## Git History

**Commits**: Include [WP02.5] in commit message

## Activity Log

- 2025-11-21: Task created

- 2025-11-22T13:31:20Z: Moved from planned to doing

- 2025-11-22T13:32:04Z: Moved from doing to for_review

- 2025-11-22T13:40:49Z: Moved from for_review to done
