---
id: WP02.2
task_id: T016
title: Define Agent table with status enum, depth_level, parent_id in migration
phase: Phase 2 - Foundational
lane: done
status: pending
created_at: 2025-11-21
started_at: 2025-11-22T13:31:20Z
completed_at: 2025-11-22T13:40:49Z
estimated_time: 20min
actual_time: null
depends_on: [T015]
files_modified: []
---

# WP02.2: Define Agent table schema

## Objective

Define the Agent table schema within 001_initial_schema.sql with status enum, depth tracking, parent relationships, and metadata fields.

## File Paths

- `migrations/001_initial_schema.sql` (Agent table section)

## Work Content

1. Define agent_status enum type:
   - 'idle', 'running', 'paused', 'completed', 'failed', 'terminated'
2. Create Agent table with columns:
   - id UUID PRIMARY KEY
   - name VARCHAR(255) NOT NULL
   - description TEXT
   - status agent_status DEFAULT 'idle'
   - depth_level INTEGER DEFAULT 0
   - parent_id UUID REFERENCES Agent(id)
   - created_at TIMESTAMP DEFAULT NOW()
   - updated_at TIMESTAMP DEFAULT NOW()
   - completed_at TIMESTAMP
   - metadata JSONB
3. Add indexes on status, parent_id, depth_level
4. Add CHECK constraint: depth_level >= 0

## Acceptance Criteria

- [ ] agent_status enum type created
- [ ] Agent table includes all required columns
- [ ] parent_id foreign key references Agent(id)
- [ ] Indexes created for performance
- [ ] CHECK constraint validates depth_level
- [ ] Default values set for status and timestamps

## Dependencies

Depends on T015 (migration file structure exists).

## Parallel Execution

Part of T015's migration file - sequential.

## Unit Tests

Validated through database schema tests in integration tests.

## Git History

**Commits**: Include [WP02.2] in commit message

## Activity Log

- 2025-11-21: Task created

- 2025-11-22T13:31:20Z: Moved from planned to doing

- 2025-11-22T13:32:04Z: Moved from doing to for_review

- 2025-11-22T13:40:49Z: Moved from for_review to done
