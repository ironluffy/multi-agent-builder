---
id: WP02.6
task_id: T020
title: Define Checkpoint table with state_snapshot JSONB, resume_capability
phase: Phase 2 - Foundational
lane: done
status: pending
created_at: 2025-11-21
started_at: 2025-11-22T13:31:20Z
completed_at: 2025-11-22T13:40:49Z
estimated_time: 20min
actual_time: null
depends_on: [T015]
files_modified: []
---

# WP02.6: Define Checkpoint table schema

## Objective

Define the Checkpoint table schema for storing agent state snapshots, enabling pause/resume functionality and failure recovery.

## File Paths

- `migrations/001_initial_schema.sql` (Checkpoint table section)

## Work Content

1. Create Checkpoint table with columns:
   - id UUID PRIMARY KEY
   - agent_id UUID REFERENCES Agent(id) NOT NULL
   - state_snapshot JSONB NOT NULL
   - checkpoint_type VARCHAR(50) DEFAULT 'manual'
   - created_at TIMESTAMP DEFAULT NOW()
   - restored_at TIMESTAMP
   - metadata JSONB
2. Add index on (agent_id, created_at DESC) for latest checkpoint retrieval
3. Add CHECK constraint: checkpoint_type IN ('manual', 'auto', 'failure')
4. Document JSONB schema in migration comments:
   - conversation_history
   - variable_state
   - execution_context

## Acceptance Criteria

- [ ] Checkpoint table includes state_snapshot JSONB column
- [ ] agent_id foreign key references Agent(id)
- [ ] checkpoint_type field with validation
- [ ] Index for efficient latest checkpoint queries
- [ ] restored_at tracks checkpoint restoration
- [ ] Migration includes JSONB schema documentation

## Dependencies

Depends on T015 (migration file) and T016 (Agent table exists for foreign key).

## Parallel Execution

Part of T015's migration file - sequential after T016.

## Unit Tests

Checkpoint save/restore validated in integration tests (future enhancement).

## Git History

**Commits**: Include [WP02.6] in commit message

## Activity Log

- 2025-11-21: Task created

- 2025-11-22T13:31:20Z: Moved from planned to doing

- 2025-11-22T13:32:04Z: Moved from doing to for_review

- 2025-11-22T13:40:49Z: Moved from for_review to done
