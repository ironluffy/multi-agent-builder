---
id: WP02.18
task_id: T032
title: Create SharedDatabase connection pool manager in src/infrastructure/SharedDatabase.ts
phase: Phase 2 - Foundational
lane: done
status: pending
created_at: 2025-11-21
started_at: 2025-11-22T13:31:21Z
completed_at: 2025-11-22T13:40:49Z
estimated_time: 30min
actual_time: null
depends_on: [T005, T015]
files_modified: []
---

# WP02.18: Create SharedDatabase connection pool manager

## Objective

Create a SharedDatabase class that wraps the PostgreSQL connection pool with convenient query methods, transaction support, and error handling.

## File Paths

- `src/infrastructure/SharedDatabase.ts`

## Work Content

1. Create SharedDatabase class with:
   - getInstance() singleton pattern
   - query() method for parameterized queries
   - transaction() method for multi-query transactions
   - getPool() for direct pool access
   - close() for graceful shutdown
2. Implement error handling and logging
3. Add query result typing with generics
4. Export singleton instance
5. Integration with Logger utility
6. Connection health check method

## Acceptance Criteria

- [ ] SharedDatabase singleton class created
- [ ] query() method supports parameterized queries
- [ ] transaction() method wraps BEGIN/COMMIT/ROLLBACK
- [ ] Error handling with descriptive messages
- [ ] Logging integration for query execution
- [ ] Generic typing for query results
- [ ] Graceful shutdown with connection draining

## Dependencies

Depends on T005 (db.ts connection pool) and T015 (database schema exists).

## Parallel Execution

Sequential - depends on T005 completion.

## Unit Tests

Unit test in tests/unit/infrastructure/SharedDatabase.test.ts for query and transaction methods.

## Git History

**Commits**: Include [WP02.18] in commit message

## Activity Log

- 2025-11-21: Task created

- 2025-11-22T13:31:21Z: Moved from planned to doing

- 2025-11-22T13:32:05Z: Moved from doing to for_review

- 2025-11-22T13:40:49Z: Moved from for_review to done
